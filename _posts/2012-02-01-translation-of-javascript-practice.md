---

title: 【自译】javascript最佳实践
---

{{ page.title }}
===============

[Javascript最佳实践](http://www.javascripttoolbox.com/bestpractices/)



该文是一个关于开发javascript代码的较好风格和实践准则的列表，这些都来自于javascript社区众多开发者的建议和经验。该文只列出的只是一些建议而不是绝对准则，有经验的开发者可能会持有与本文略微不同的观点。

  

1，  总是使用var关键字。

Javascript里的变量定义域或者是全局的，或者是限于函数的。使用var关键字对于控制变量的作用域非常重要。声明变量的时候，不管是全局变量函数局部于函数的变量，始终使用var关键字。下面的例子能够突出不这么做可能导致的问题。

   

因为函数内部的变量i没有使用var声明为函数级别的局部变量，在这个例子里将会引用到全局变量。声明全局变量时总是使用var是个好习惯，但是声明局部于函数的变量时也这样做同样很有意义。下面两种写法在功能上是一样的。

    

2，  探测特性而不是探测浏览器。

通常会有一些代码通过探测浏览器的版本来决定该采取怎样的动作。但是，总体而言，这是一种非常糟糕的方法。任何代码哪怕只是使用navigator全局对象都需要仔细审查。推荐使用特性探测的方法，具体来说就是在使用一些较老浏览器可能不支持的高级特性时，先检查功能或者属性是否存在，然后再使用。这种方法比探测浏览器版本并且自认为知道其特定功能要更好。在[这篇文章](http://www.jibbering.com/faq/faq_notes/not_browser_detect.html)有关于这个课题的深入探讨。

     

      

3，  使用方括号。

当要使用在运行时才能确定或者与点号不兼容的对象属性时，请使用方括号。如果你在javascript方面还是个新手，总是使用方括号也不是个什么坏的习惯。

Javascript的对象属性主要可以通过两种方式引用：点号或者方括号。

       

使用点号时，属性名被硬编码了，而且在运行时无法改变。使用方括号时，属性名是一个字符串，其能够被求值从而获取具体属性。这个字符串可以是硬编码的，也可以是个变量，甚至还可以是一个返回字符串的函数调用。

如果属性名是在运行时才明确的，则方括号引用法是必须的。例如，你有属性value1,value2和value3,而你想去使用变量i=2去获取属性值。



还有，在一些服务器端编程环境（php，structs等等）下，表单域名有时候以[]结尾以表示该表单域在服务器端应该当作数组处理。这样就无法用点号引用此种域名，因为在javascript语法里面方括号是用来引用数组的，这时方括号就是必须的了。

         

对于使用方括号的建议是在必须的时候一定要使用。在并不严格需要的时候就是个人爱好与习惯的问题。一个很好的经验法则就是使用点号来获取对象的标准属性，使用方括号获取在本页内被定义的属性。所以，尽管使用方括号的这种写法document["getElementById"]()完全合法，但是document.getElementById()是更好的写法，因为getElementById是在dom规范里面清楚定义的文档对象的标准属性。混合使用点号和方括号可以让我们清楚分别哪些是标准属性，哪些是上下文中的名称。

          

在上面这个例子里，forms是document的标准属性，而myformname则只是在此上下文中使用而已。类似的，elements和value都都属于规范定义的标准，而myinput只是在该页定义。这种写法非常清晰而且极易理解，是一种值得推荐的风格，但是也不是严格的规则。

           

4，  避免使用eval。

Javascript里的eval()函数允许在运行时执行任意代码。我们应该极力避免使用它。总有一种更正确的方式可以取代它以完成你要做的事情。例如，eval()函数经常被不熟悉方括号的程序员使用。

关于eval的规则是：“eval是魔鬼！”。除非你是一个非常有经验而且很明确你自己在干什么。

            

5，  正确的引用表单和表单元素

所有的html表单都必须有一个name属性。而对xhtml文档来说，name熟悉不是必须的，但是id属性必须存在，而且表单必须通过document.getElementById()的方式被引用。使用索引方式引用表单几乎在任何情况下都不是个好办法。在有些浏览器可以通过把表单名用作文档的属性的方式引用表单，这不是个靠谱的方法，不推荐使用。

下面的这个例子通过使用方括号和对象引用给出了一种最不容易出错的引用表单输入的方法。

             

如果你要在一个函数里引用多个表单元素，最好先把表单对象存到一个一个变量里面，这可以减少解析表单引用的开销。

              

在使用onChange或者类似的事件处理函数做输入域验证时，请把输入元素自身作为一个参数传入。每一个表单内的输入元素都可以引用到它所属的表单对象。

               

通过这种方式，就不需要硬编码表单名了，这样写出来的代码有更好的可重用性。

6，  避免使用with。

Javascript里的with语句在作用域链前插入一个对象，任何变量或者属性的引用都是基于该对象的，它通常被用来减少代码量。



上例的问题在于，程序员无法判断input1和input2是不是真的被解析成表单元素数组的属性。因为首先这些名字会被检查是不是其属性，如果不是就会在上层定义域查找，最终会查找到将input1和input2当成全局变量的全局对象，并且尝试去设置它们的value属性，这样最终导致一个错误。

相反，我们可以通过重用对象的引用来达到减少代码量。



                  

7，  在超链标签里面使用onclick而不是“javascript:”伪协议。

在你想在<A>标签之中触发javascript代码，请使用onclick处理，而不是使用“javascript:”伪协议。Onclick处理代码必须返回true或者false，如果返回true将正常的跳往该链接，如果返回false，什么也不会发生。这也就是为什么在很多onclick处理代码最后有"return false;"这样一句代码的原因。

                   

在上面这个例子，链接被点击的时候doSomething将会被调用，最后返回false。在启用javascript的浏览器上不会跳转，但是如果在没启用javascript的浏览器上javascript_required.html将会载入，你正好可以在那里告诉用户启用javascipt。通常，我们在确定用户开启了javascript的时候，为了简单起见，我们通常这样写href="#"。这不是个值得鼓励的做法。建议为禁用了javascript的用户提供一个本地备份页。

有时候跳往超链之前需要做条件判断。例如用户要离开表单页，那你首先要做的就是确认没有什么被改动。这种情况下，点击链接将会触发一个函数，从该函数的返回值确定是否该跳往超链。

                    

在上面这个例子，validate函数或者返回true或者返回false。如果返回true，将被允许跳往主页，返回false则不允许。该段代码要求用户进行确认根据用户的选择相应的返回true或者false。

以下是一些反面例子，如果在你的页面看到这些代码应该要尽快修复。

                     

8，  使用一元运算符“+”做到数字的类型转换。

在javascipt中，“+”既用来做连接又用来加法。在表单域值求和的时候这样可能会造成问题，因为javascript是无类型的语言。表单域值会被当成字符串，如果对它们做“+”运算，javascript会把它当成连接而不是相加。

                      

要修复这个问题，javascript需要额外的提示以确定把操作数当成数字而不是字符串。一元操作符“+”就能用来将字符串转换成数字。在变量或者表达式前面加上“+”能够强制将其解析为数字，这样就能够在数学操作中正常使用。

                       

                        

9，  避免使用document.all。

document.all是被ie引入但又不是一个标准的dom特性。尽管一些较新的浏览器为了兼容糟糕的代码而支持这一特性，但是还是有许多浏览器不支持。

除非没有其他的办法而且需要支持早期版本（<5.0）的ie，否则永远都不要使用document.all。你也不能通过检查是否有这一特性来判断浏览器是不是ie，因为可能其他的浏览器也支持这一特性。

                         

以下是一些使用document.all的准则：

1）首先尝试其他的标准方法；

2）在万不得已的情况下才使用其作为一个备份方法；

3）只在你需要支持ie5.0之前版本时才使用；

4）在使用之前，用“if (document.all) { }”检查其是否被支持。

10，不要在脚步块里面使用html注释。

在javascript的远古岁月，类似于Netscape1.0这样的浏览器不支持script标签。所以在javascript出现的时候，需要一种方法向浏览器隐藏javascript代码使得其不在页面上显示。一种方法就是在脚本块中使用html注释隐藏代码。

                          

现在没有哪个通用浏览器会忽略<script>标签，所以隐藏javascript源代码也就没有必要了，而且因为以下理由，这种做法通常被认为是有害的。

1）  在xhtml文档里，源代码事实上对浏览器是不可见的，在渲染页面上也是无用的；

2）  Html注释里面--是不被许可的，所以脚本里的任何自减操作都是无效的。

11，避免污染全局名字空间。

全局变量或者函数很少是真的必须的。全局的东西通常会造成源文件直接的名字冲突进而导致代码出错。将功能封装在一个单一的全局名字空间里面是一个好的做法。

要达成这样的目的有许多不同的做法，有些简单，有些则复杂的多。最简单的办法是创建一个单一的全局对象，并赋予其一些属性和方法。



[闭包](http://www.jibbering.com/faq/faq_notes/closures.html)也能够用来创建名字空间，[私有成员变量](http://www.crockford.com/javascript/private.html)也能javascript中进行模拟。


12，避免同步ajax调用。

进行ajax请求的时候能够选择同步或者异步模式。异步模式运行在后台从而其他的浏览器活动能够继续进行，同步模式则需等待请求返回才能继续。

应该要避免同步模式的请求。这样的请求会在请求返回之前卡死。在服务器很忙反应较慢的情况下，用户的浏览器将也干不了。要是一直没有收到响应，浏览器将持续阻塞直到请求超时。

如果你认为你的场景确实需要同步模式，最好先重新思考一下你的设计。几乎不存在非同步模式不可的情况。

13，使用json。

当需要把数据结构保存为纯文本或者需要使用ajax接收/发送数据结构的时候，尽量使用json而不是xml。[Json](http://www.json.org/)更紧致，更高效，而且还是语言中立的。

14，正确的使用<script>标签。

<script>标签里的LANGUAGE属性已经被弃用。创建代码块的正确方法如下：

