---
layout: post
title: 上家公司内刊约稿旧文一篇 
---

{{ page.title }}
===============

## 重回学生时代
                                            ——六月份ponder this 之解答

IBM Research的ponder this（1）栏目在很多数学和计算机科学爱好者中颇为流行。管理员每个月初会在ponder this页面上贴上本月的挑战题，类型或者偏向于计算机，或者偏向于数学，但是题目的难度并不是很大，在贴上本月问题的同时还会贴上对上个月问题的一个简单解答。

笔者第一次尝试解答的ponder this题目是09年6月份的这道数论题，很幸运的是笔者的解答被认为是正确的，因此本人的名字有幸出现在已解答者列表上。原题的英文描述在这里（2），为了后续讨论能够展开，笔者这里先描述一下这道题目：

我们知道每一个n元素的排列都可以看成一个一一映射，例如排列(3,4,6,2,1,5)对应的映射便是：1->3, 2->4, 3->6, 4->2, 5->1, 6->5。如果定义对一个序列施加一次排列操作就是对这个序列施加一次该排列对应的映射操作，则很显然每对序列施加一次排列操作，序列元素的位置都要发生改变。1在序列(1,2,3,4,5,6)中的初始位置是1，施加了排列(3,4,6,2,1,5)操作之后，1的位置被换到了5，得到的新序列为(3,4,6,2,1,5)，如果再对序列(3,4,6,2,1,5)施加排列(3,4,6,2,1,5)操作，1的位置将会被换到6。我们记Π为1-14的一个排列，Ni为要使一序列的i回到初始位置，需要对该序列施加Π作用的最小次数。例如需要对序列(1,2,3,4,5,6)施加4次排列(3,4,6,2,1,5)作用，才能使得1回到初始位置，3，5，6也都需要4次，而2，4则只需要2次。现在要求得这样一个式子的值：

![]({{ site.img_url }}/ponder-this.jpg)

首先我们需要对每一个排列Π求一个幂，这个幂的底数为4，指数为14个数的连积，第i个乘数是2还是3取决于在当前Π作用下Ni取值的奇偶性，然后我们对这14！个幂求和，最后求这个和除以1299的余数。

让我们来考虑这个题的解答。我们知道和的余数在同余的意义上等于于余数之和，所以我们考虑单项，即各个幂的情况。幂的形式可以表示成4^(2^x*3^y)，其中x+y=14，即在当前排列下有x个数需要偶数次作用才能回到初始位置，有y个数需要奇数次作用才能回到初始位置。一个幂除以一个数的余数让我们很容易联想到数论里的欧拉定理（3），欧拉定理是说：如果两个正整数a，m互质，则a^Φ(m)=1（modm），Φ(x)是欧拉函数，定义为比x小且与x互质的正整数的个数。除数1299有点大，不太方便操作，我们尝试将1299分解，1299=433*3，433和3都已为质数,无法再分解。如果对于一个数我们既求出了它除以3的余数，又求出了它除以433的余数，那么根据中国剩余定理，我们也就能求出它除以1299（=433*3）的余数。因为幂的余数在同余意义上等于余数的幂，于是4^(2^x*3^y)=(4mod3)^(2^x*3^y)(mod3)=1(mod3)，则整个和式的除以3的余数便等于14！个1除以3的余数，为0。此时再对4和433运用欧拉定理，有4^Φ(433)=4^432=1(mod433)，指数432=2^4*3^3，依然较大，但至少让我们看到了方向，事实上我们有4^36=1(mod433)，别问我怎么知道的，在探索解题思路的过程中你自然会发现。

在获得更多性质之前，我们可以认为式子4^(2^x*3^y)，x+y=14中x有0-14共15种取值可能，对于2<=x<=12（此时12>=y>=2)时，2^x*3^y是36的倍数，因为4^36=1(mod433)，自然此时的4^(2^x*3^y)=1(mod433)。那么剩下了我们只需要考虑(x,y)=(0,14)或者(1,13)或者(13,1)或者(14,0)这四种情形。

事实上(1,13)和(13,1)这两种情况下是不可能有排列存在的。学过群论的读者都知道，一个排列可以表示成若干个循环(cycle)之积，例如(3,4,6,2,1,5)表示成循环之积的形式即为(1,3,6,5)(2,4)，用映射表示即为1->3，3->6，6->5，5->1；2->4，4->2。由映射我们可以发现一个数回到初始位置需要排列Π作用的次数正好等于它所在的的循环的长度，但是x=1则意味着只有1个数需要偶数次作用，也就是说只有1个数位于偶数(>=2)长的循环中，这显然是荒谬的；x=13则意味着有且只有13个数位于偶数长循环中，但是若干偶数之和不可能为13。所以(x,y)=(1,13)或者(13,1）是不可能的，其实我们可以发现x为奇数都是不行的，因为偶数之和不可能等于奇数。

于是剩下的问题就是需要找出有多少个排列满足(x,y)=(0,14)，有多少个排列满足(x,y)=(14,0)，即有多少个排列可以表示偶数长度循环之积，有多少个排列可以表示成奇数长度循环之积。不烦分别设为M1和M2，则整个和式除以433的余数在同余意义上等于M1*4^(3^14)+M2*4^(2^14)+(14!-M1-M2)*1。为求M1可以分两步，第一步求能表示成全奇循环之积的排列有多少种形式(type)，此时的形式即排列的循环表示中有几个长度为3的循环，几个长度为5的循环等等，这其实是一个整数剖分问题(partition（4）)；第二步求每种形式有多少个具体的排列，因为具有相同形式的排列被称为彼此共轭，而求一个共轭类的数目有公式可用，具体可以参看《组合数学》（5）。通过几十行的代码（6）我们可以求出M1=M2=18261468225。又4^(3^14)=4^(3^14%36)(mod433)=4^9(mod433)=179(mod433)，同样4^(2^14)=4^(2^14%36)(mod433)=4^4(mod433)=256(mod433)。于是M1*4^(3^14)+M2*4^(2^14)+(14!-M1-M2)*1=M1*179+M2*256+14!-M1-M2(mod433)=M1*(179+256)+14!-2*M1(mod433)=2*M1+14!-2*M1=14!(mod433)=215。和式除以3余0并且除以433余215，由中国剩余定理可以得出和式除以1299(=433*3)余618。

其实这里的M1=M2不是偶然的，当n为偶数时，事实上能够表示成全奇循环之积的排列数和能够表示成全偶循环之积的排列数总是相等的。在ponder this六月份的解答中，管理员给出了一个证明思路：将排列的全奇循环之积写出权威(canonical)形式，对每个循环循环左移（或右移）若干次，使循环中最大数出现在首位置，然后将每个处在奇数位置上的循环的最后一个数插入到其后循环的最后一个数的后面，此时循环必有偶数个，所以这种操作可以进行下去。显然，经过这样的操作之和，一个由全奇循环构成的排列变成了一个由全偶循环构成的排列，可以证明这种变换是一一对应的，因此M1=M2总是成立。可以看到，如果我们的数学够好或者思维能够敏锐到这种程度，则完全不需要计算机的帮忙我们就可以轻松地得到答案。
                                                                            
(1)，http://domino.research.ibm.com/Comm/wwwr_ponder.nsf/pages/index.html
(2)，http://domino.research.ibm.com/Comm/wwwr_ponder.nsf/Challenges/June2009.html
(3)，http://zh.wikipedia.org/wiki/%E6%AC%A7%E6%8B%89%E5%AE%9A%E7%90%86_(%E6%95%B0%E8%AE%BA)
(4)，http://zh.wikipedia.org/w/index.php?title=%E6%95%B4%E6%95%B8%E5%89%96%E5%88%86&variant=zh-cn
(5)，卢开澄，卢华明，清华大学出版社
(6)，把代码贴上来有凑字数之嫌，因此又需要的同事们还是私底下找我要吧

